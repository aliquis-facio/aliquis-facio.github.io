# 8-1. Web Security

## 1) WEB/HTTP 개요

- **클라이언트–서버, 무상태(Stateless)** 모델. 요청/응답 메시지 구조(요청라인·헤더·바디 / 상태라인·헤더·바디), URL 구성요소(스킴·호스트·포트·경로·쿼리·프래그먼트).

## 2) Web Shell

- **CWE-434(임의 파일 업로드 허용)**로 웹서버가 실행파일을 업로드·실행하게 되면 **원격 명령 실행**이 가능.
- **대응**: 업로드 제한(확장자/크기·MIME 검사), 실행권한 제거, 웹앱에 루트 권한 금지.

## 3) Cookie

- **역할**: 무상태 HTTP에 **상태** 부여(인증·장바구니·세션 식별 등). `Set-Cookie` 속성: `domain`, `path`, `secure`, `expires`, (현대 브라우저의 `HttpOnly`).
- **문제**: 서버는 실제로 **name=value**만 보며, 클라이언트가 **임의 조작** 가능(쿠키 포이즈닝). SSL 미적용 구간에서는 **탈취 위험**. **도메인/경로 스코프 충돌**로 세션 오염 가능(서브도메인 간).
- **대응**: 전 구간 **TLS**, **무결성 태그(서버비밀키 기반 MAC)**로 값 위조 방지.

## 4) 세션 관리(Session Management)

- **세션 토큰 전달 위치**: 쿠키, URL 파라미터, 숨김필드.
- **위험**:
    - **Referer 유출**(URL에 토큰 포함 시 제3자에 노출),
    - **토큰 예측 가능성**,
    - **세션 하이재킹(토큰 탈취)**,
    - **세션 고정(Session Fixation)**—공격자가 미리 정한 토큰으로 로그인 유도.
- **대응**:
    - **로그인 시 토큰 재발급(익명→로그인 전환 시 반드시 새 토큰)**,
    - **강한 토큰 설계**(예: `SID=[userID,exp,data]`, `Token=HMAC_k(SID)`),
    - 클라이언트 특성(IP/UA) 일부 포함(완벽하진 않지만 난이도 상승),
    - 매 요청마다 **로그아웃 상태/만료 검사**.

## 5) XSS(Cross-Site Scripting)

- **정의**: 사용자 입력을 적절히 **중화(escape/필터)**하지 않고 페이지에 반영할 때 **스크립트 주입** 발생.
- **유형**:
    - **Persistent(저장형)**: 게시판/메일 등 저장된 악성 스크립트가 다른 사용자에게 전파.
    - **Reflected(반사형)**: 쿼리스트링 등 요청에 섞인 스크립트가 즉시 응답에 반사.
- **영향**: 세션 쿠키 탈취, DOM 조작, 피싱·키로깅 등.
- **대응**:
    - **입력 검증**과 **출력 인코딩**(컨텍스트별—HTML/속성/JS/URL),
    - 스크립트 비활성화(콘텐츠 보안 정책 CSP 등 개념적으로 연결),
    - 예시: `< > " '` 등을 HTML 엔티티로 치환.

# 8-2. Web Security

## 1) CSRF (Cross-Site Request Forgery)

- **개념**: 사이트가 사용자의 브라우저를 신뢰한다는 점을 악용해, 로그인 상태의 사용자가 **의도하지 않은 요청**을 보내게 만드는 공격. XSS가 “사용자가 사이트를 신뢰”하는 점을 노린다면, **CSRF는 “사이트가 브라우저를 신뢰”**하는 점을 노립니다.
- **사례**:
    - 이미지 태그로 **송금 URL**을 로드해 자동 요청 유발(쿠키 동반).
    - 관리자 비밀번호 **강제 초기화** 요청을 XSS와 결합해 실행.
- **성공 전제**: Referer 미점검, 부작용 있는 URL/폼 존재, 필요한 파라미터를 공격자가 추측 가능, 사용자가 로그인된 상태로 악성 페이지 방문.
- **대응**: 세션 관리 강화, **GET/POST에 추가 인증 요소** 요구, **Referer 점검**, 인증 쿠키 **수명 제한**, **POST 처리 시 GET 파라미터 무시**, **사용자별 CSRF 토큰** 검증.

---

## 2) SQL Injection

- **개념**: 입력을 적절히 **이스케이프/검증**하지 않거나 강타입 검증이 없어 **SQL 문맥이 깨져** 의도치 않은 쿼리가 실행됨.
- **고전 예시**: `' or '1=1'--` 로 WHERE 절을 항상 참으로 만들어 인증을 우회. (MSSQL에서 `--`는 주석)
- **더 심각한 피해**: `'; DROP TABLE members --` 로 **테이블 삭제** 등 데이터 파괴.
- **대응**: 입력 **불신·화이트리스트 검증**, **특수문자 필터/이스케이프**, **에러 메시지 노출 금지**, **DB 계정 최소 권한**.

---

## 3) IDOR (Insecure Direct Object Reference)

- **개념/예시**: 예측 가능한 리소스 식별자를 노출하면 사용자가 번호만 바꿔 **권한 밖 리소스**에 접근 가능(예: `one-piece-554-english.html` → `…555…`).
- **대응**: **난수화/간접 참조** 적용 + **매 접근 시 권한 확인(Authorization)**.

---

## 4) 관리자 영역 접근 통제

- **원칙**: 관리자 페이지는 **접근 자체를 제한**하고, 추측 쉬운 경로명 사용 금지(`/admin`, `/manager`, 하위 도메인 등).
- **대응**: **별도 포트 + 방화벽 ACL**, **웹서버 레벨 디렉터리 접근 제어(Allow/Deny, IP 화이트리스트)**. 설정 예시:
    ```
    <Directory /www/admin/>
      AllowOverride AuthConfig
      Order deny, allow
      Deny from all
      Allow from IP lists
    </Directory>
    ```
    

---

## 5) 취약점 스캐너

- **정의/주의**: 알려진 취약점을 자동 탐지(nmap, nessus 등). 일부는 **실제 공격을 수행**하므로 서비스 영향에 유의.
- **종류**: **블랙박스**(Nikto, Burp Scanner, Acunetix 등) / **화이트박스**(Fortify SCA, HP DevInspect, PMD 등).

# 8-3. OWASP TOP 10
## 개요

- **OWASP Top 10**은 가장 흔하고 영향력이 큰 웹 애플리케이션 취약점을 정리한 리스트로, 개발자·설계자·관리자에게 실전형 보안 지침을 제공합니다. 문서는 커뮤니티 데이터와 설문을 바탕으로 정기 갱신됩니다.

## 2013 → 2017 변화 포인트

- **신규 추가**: A8 안전하지 않은 역직렬화, A10 불충분한 로깅/모니터링
- **병합/삭제**: IDOR와 기능 수준 접근통제 → **A5 취약한 접근 통제**로 통합, **CSRF**는 주류 프레임워크의 방어 내장으로 제외, **검증되지 않은 리다이렉트/포워드**는 우선순위에서 밀려 제외.

## 위험 평가 관점

- 위험도는 **공격 가능성·확산 정도·탐지 가능성·기술적 영향**을 조합해 본문에서 설명하는 방법론으로 산정합니다(조직별 맥락 반영 권장).

## Top 10 한눈에 보기 (요약·대응)

### A1 인젝션 (SQL/LDAP/OS/Template 등)

- **개념**: 신뢰할 수 없는 입력이 인터프리터로 전달되어 쿼리/명령이 변조.
- **대응**: **매개변수화된 쿼리/안전 API**, 상황기반 **화이트리스트 검증**, 동적 쿼리 최소화, **LIMIT** 등으로 대량 노출 제한.

### A2 취약한 인증

- **개념**: 인증·세션 관리 결함으로 계정 탈취/세션 하이재킹 유발.
- **대응**: **MFA**, 약한 비밀번호 차단(최악 리스트 거절), 균일한 에러 메시지(열거 방지), **세션 토큰 보호·만료·무효화**.

### A3 민감한 데이터 노출

- **개념**: 저장/전송/처리 중 데이터가 평문 또는 약한 암호로 노출.
- **대응**: **전 구간 TLS(PFS, HSTS)**, 저장 시 강력한 암호화·키관리, **비밀번호는 Argon2/scrypt/bcrypt/PBKDF2**로 해시, 캐시/백업까지 범위 포함.

### A4 XML 외부 개체(XXE)

- **개념**: XML 파서의 외부 개체/DTD 처리로 내부파일 유출, SSRF, DoS.
- **대응**: **외부 개체/DTD 비활성화**, 라이브러리 패치, 가능하면 **JSON 사용**, 업로드 시 **스키마 검증**, SAST/DAST로 탐지.

### A5 취약한 접근 통제

- **개념**: 권한 검사 부재/우회로 데이터·기능에 비인가 접근.
- **대응**: **기본 거부(deny-by-default)**, **서버측 강제**(클라이언트 신뢰 금지), **소유자 기반 권한** 강제, 관리자 기능 보호, JWT 무효화·재사용 방지, 속도 제한·로깅.

### A6 잘못된 보안 구성

- **개념**: 디폴트 계정·디렉터리 리스팅·상세 에러·취약 헤더 등 설정 부실.
- **대응**: **표준 하드닝 절차 자동화**, 불필요 요소 제거, 패치 관리, **보안 헤더** 적용, 클라우드 스토리지 권한 점검.

### A7 크로스사이트스크립팅(XSS)

- **개념**: 신뢰 불가 데이터가 HTML/JS 컨텍스트에 삽입되어 브라우저에서 스크립트 실행.
- **대응**: **컨텍스트별 인코딩/검증**, 프레임워크의 자동 방어 활용, **DOM-XSS** 방지 코딩, **CSP**로 심층 방어.

### A8 안전하지 않은 역직렬화

- **개념**: 악성 직렬화 데이터 역직렬화로 **원격코드실행(RCE)**·권한상승.
- **대응**: **신뢰 불가 객체 수용 금지**(또는 원시 타입만), **무결성 서명**, **타입 허용목록**, 격리·최소권한 실행, 예외/이상 로깅·모니터링.

### A9 알려진 취약점이 있는 구성요소 사용

- **개념**: 취약 라이브러리/프레임워크 사용으로 간접 침해.
- **대응**: **SBOM/자산화**(버전 인벤토리), **SCA 도구(Dependency-Check, retire.js)**, 신뢰 소스·서명 패키지, 패치 불가 시 **가상 패치**.

### A10 불충분한 로깅 & 모니터링

- **개념**: 탐지·경보·대응 부재로 침해 장기화·피해 확산.
- **대응**: **인증/접근통제/고가치 트랜잭션 로깅**, 중앙집중 로그·무결성 보호, **유의미한 경보·에스컬레이션**, **IR 계획(NIST 800-61)**.
