# Ch.5 전자결제(Payment Systems)

## 1) 전자결제 기본 구조

- **다자간 프로토콜**: 고객(Payer), 상인(Payee), 은행(Bank)이 참여. 전자 화폐(coin)는 **고정 가치의 전자 토큰**으로 모델링됨.
- **거래 단계**: (1) 고객의 **인출(Withdrawal)** → (2) 고객의 **지불(Payment)** → (3) 상인의 **입금(Deposit)**.
- **온라인/오프라인**: 온라인은 **은행이 실시간 개입**해 이중지불 차단, 오프라인은 거래 시 은행 불참여(다른 방식으로 이중지불 탐지).

## 2) 목표(보안/프라이버시)

- **무결성**: 위조 불가, 유효 코인만 정산.
- **책임성(부인방지)**: 사후 분쟁 해결 가능, 거래 부인 어렵게.
- **프라이버시**: 당사자 신원/연결성 최소 공개(**트레이서빌리티 축소**).

## 3) 기본 디지털 서명형 전자현금

- 코인은 **은행 서명**이 붙은 무작위 식별자. 상인은 은행 서명을 검증하고, 은행은 **서명 검증 코인만 입금** 처리.
- 한계: 고객이 **복사(이중지불)** 할 수 있고, **은행이 모든 거래 내역을 알게 됨**(프라이버시 약함).

## 4) 블라인드 서명 기반 “프라이빗 결제”

- **블라인드 서명(Chaum)**: 은행이 **내용을 보지 못한 채** 코인에 서명 → 은행은 코인-고객 연결을 모름(언링커빌리티).
- **RSA 블라인드 서명 요지**
    - 고객: 무작위 r 선택, ($y = r^e \cdot h(x) \bmod N$) 전송.
    - 은행: ( $\sigma(y)=y^d \bmod N$) 반환.
    - 고객: 언블라인딩 ( $\sigma(x)=\sigma(y)\cdot r^{-1} \equiv h(x)^d \bmod N$)로 유효 서명 획득.
- **유효 코인만 서명**받게 하는 절차(컷앤초즈): k개의 코인을 제출하면 은행이 **k−1개 무작위 개봉 검사**, 나머지 1개를 블라인드 서명 → **유효일 확률 (1-1/k)**.
    

## 5) 이중지불(더블스펜딩) 대응

- **온라인**: 은행이 실시간 중복 체크로 즉시 차단.
- **오프라인**: 코인에 **암호화된 고객/상인 신원 조각**을 내장해, 동일 코인이 두 번 쓰이면 **사기 당사자 신원 복구**(탐지·추적형).

## 6) 신원 은닉과 검출을 위한 해시 커밋·분할

- **비밀 분할(XOR)**: (x = y \oplus z). 단독 조각(y 또는 z)만으로는 **정보 누설 0**.
- **커밋 쌍**: (a=h(y),; b=h(z)). 코인은 **식별자 x**와 **커밋 쌍 (a_i,b_i)_{i=1..n}** 벡터로 구성 → 코인 자체는 고객 신원 비공개.
- **지불 시**: 고객이 **선택 벡터** (s_1..s_n) 제시, 각 (s_i)에 따라 (h(P_i)=a_i) 또는 (b_i)가 되도록 **해시 프리이미지 (P_i)** 공개(검증 가능).
- **입금/탐지 성질**: 서로 다른 두 상인이 **같은 선택 벡터**를 받을 확률은 (1/2^n) → **이중지불 시 고객 신원 복원 확률 (1-1/2^n)**. 상인이 들키지 않고 이중지불하려면 **해시 충돌**을 찾아야 함(현실적으로 어려움).