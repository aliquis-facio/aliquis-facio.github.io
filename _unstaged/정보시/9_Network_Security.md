# 9-1. 네트워크 보안

## 9.1. ARP Spoofing / Poisoning / Flooding

- **개념**: 공격자가 ARP를 속여 **트래픽을 가로채거나 변경·차단**하게 만드는 기법(ARP spoofing/poisoning; 지속적 가짜 응답 전송은 ARP flooding).
- **동작 예**: A가 “Who is R?”라고 묻는 ARP Request에 공격자 B가 “It’s me”로 회신 → **잘못된 MAC**이 ARP 캐시에 기록됨(=poisoning) → B가 계속 가짜 Reply를 보내 캐시를 유지(=flooding).
- **영향**: A의 웹·메시지·VoIP 등 모든 내용이 B를 **경유**하므로 도청/변조 가능(대표적이고 도구도 많음).

---

## 9.2. MITM(Man-in-the-Middle)

- **정의**: 통신 양단 사이에 **중간자 프록시**가 개입하는 일반적 문제(고전 **Diffie-Hellman**도 취약).
- **대응**: **PKI**, **일회용 키(원타임 패드)**, **강한 상호 인증**, **세컨드 채널 검증** 등.

---

## 9.3. Smurf 공격 (ICMP 증폭 DoS)

- **개념**: 피해자 IP를 **소스**로 위조한 **브로드캐스트 ICMP Echo**를 발송 → 다수 호스트가 Echo Reply를 피해자에게 보내 **서비스 불능** 유발.
- **대응**: 호스트/라우터에서 **브로드캐스트 ping 응답 금지**, **브로드캐스트로 향하는 패킷 포워딩 차단**(예: Linux `echo "1" > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts`).

---

## 9.4. 패킷 스니핑(탐지·수집) 포인트

- **L1 Tap**: **네트워크 탭**으로 링크의 흐름을 직접 미러링해 관찰.
- **허브(Hub)**: 물리계층(L1) 장치, **수신 프레임을 모든 포트로 복사**하는 멀티포트 리피터 → 같은 세그먼트의 패킷을 **누구나** 볼 수 있음.
- **스위치(Switch)**: **MAC 테이블**(MAC, 인터페이스, 타임스탬프; TTL 예: 60분)로 학습 전송 → 충돌 문제를 해결.
- **주의**: 스위치도 완벽하진 않음—**ARP Request는 세그먼트 전체에 도달**, 테이블을 **오버플로**시키면 MAC flooding 가능.

---

## 9.5. MAC Flooding

- **공격**: 임의의 **소스 MAC**으로 다량의 프레임을 보내 **스위치 테이블을 넘침** → 스위치가 허브처럼 동작해 프레임이 광범위로 복사.
- **대응**: **MAC-레벨 접근 통제**(예: 포트별 MAC 제한), **IP:MAC 관계 감시**(ARPwatch/IDS 등); 라우터 환경에선 **오탐**도 고려.

## 9.6. IP Spoofing

- **개념**: 로우 소켓 등으로 **송신 IP를 임의 변경**해 패킷을 생성하는 기법.
- **문제점/영향**:
    - **DoS/DDoS**(예: SYN flooding, Smurf 등) 유발, 출발지 은닉으로 **추적 곤란**.
    - **IP 기반 신뢰 서비스**(RPC, rlogin/rsh 등), **IP 주소 인증 의존 서비스**에 취약.
- **대응**:
    - **Ingress/Egress 필터링**(RFC 2827, “착한 시민” 접근이지만 운영상 어렵기도 함).
    - **백본 수준의 경로 기반 분산 패킷 필터링(RDPF)**: 라우팅 경로에 맞지 않는 인접 링크에서 온 패킷을 드롭.
    - **프로토콜/서비스 설계에서 IP Source에 의존한 인증 금지**.

---

## 9.7. Session Hijacking (TCP)

- **정의**: 유효한 세션을 **가로채 비인가 접근**을 얻는 공격(애플리케이션 계층—예: **HTTP 쿠키 탈취**—도 가능).
- **핵심 메커니즘**: **TCP Initial Sequence Number(초기 시퀀스 번호)** 예측 가능성 악용 → 가능성 높은 시퀀스 범위를 **패킷 폭주로 주입**하여 기존 연결에 **주입/명령 실행**.
- **공격 시나리오 예**: B와 신뢰 관계인 A에 대해, E가 **B의 IP로 스푸핑**하고, A의 초기 ISN을 추정·큐를 DoS로 막은 뒤 **B인 척 패킷 주입**(수신은 못해도 명령 실행 가능).
- ![](2025-10-14-12.jpg)
- **대응**:
    - **강한 ISN 생성(RFC 1948)**: ISN = M + F(sip, sport, dip, dport, secret).
	    - M: Monotonically increasing clock/counter
	    - F: Crypto hash
	    - secret: 해시 함수의 선택적 파라미터. 서버에서만 생성 및 사용
    - **암호화 사용**, **중요 앱은 애플리케이션 계층 인증 추가**.

---

## 9.8. Injecting False Routing Information

- **개념**: 공격자가 **라우팅 프로토콜 패킷 위조**로 라우터의 테이블을 오염시켜 트래픽 방향을 바꾸는 공격
- **대상 프로토콜**: OSPF, RIP, BGP 등.
- **효과**:
    - **라우팅 루프 유도**(A→D→C→A…로 순환).
	    - ![](2025-10-14-1.jpg)
    - **모니터링 지점으로 유도**(트래픽 스니핑/검열).
	    - ![](2025-10-14-2.jpg)
- **대응**: **신뢰 가능한 피어와만 인접/피어링**, **라우팅 메시지 인증(HMAC-MD5 등)**, **IPsec 활용**.

---

## 9.9. Port Scan

- **정의/목적**: 호스트의 **다양한 포트로 요청**을 보내 **열린 포트** 및 취약 서비스 식별(주공격 전 준비 단계). Finger Printing 기법. Reconnaissance
	- 도구: **Nmap, hping3**, <https://shodan.io>
	- Vertical Scanning: IP 주소 고정하고 모든 Port 번호 조합에 대해서 스캔
	- Horizontal Scanning: Port 번호 고정하고 여러 IP 주소에 대해서 스캔
- Stealthy Port Scan: 탐지 회피위한 포트 스캔 방법
- TCP SYN Scan, ACK Scan, FIN Scan, XMAS, YMAS
- **예시**:
	- SSH 취약점 노림 → **TCP/22**, UDP/22 탐색
	- LDAP 취약점 노림 → **TCP/389, UDP/389** 탐색.
- **스캔 기법**:
    - **SYN 스캔**(반개방): 열림=**SYN/ACK→RST**, 닫힘=**RST/ACK**.
    - RST을 보내면 로깅이 안 남았음
	    - ![|509x300](2025-10-14-4.jpg)
    - **ACK 스캔**: 방화벽 **필터링 판단** 등에 활용.
    - **FIN/XMAS/NULL(YMAS) 스캔**: **응답 부재/ RST** 패턴을 이용한 은닉 스캔.
    - **hping3**: 16바이트 단편화로 **보안장비 회피 시도*).
    - **IP 단편화**: **MTU 차이**로 조각난 패킷을 목적지에서 재조립.
- **탐지/대응**:
- **한 출발지에서 다수 포트 접촉** 패턴 탐지,
- 완전 분산 스캔은 난해.
- **의심 패킷 미응답** 등 소극적 대응(완전 차단은 어려움).
- Hardening: banner 정보 삭제
- CVE(Common Valnerable and Exposure): MITRE가 관리, attack이라는 체계로 분류 중

## 9.10. 방화벽(Firewall)

- **정의/역할**: 허가된 트래픽만 통과시키는 정책 기반 장치(규칙 세트로 허용/차단·NAT·IPsec 등 수행).
- **배치/형태**: 보통 **액세스 라우터 뒤**에 위치, L3/L4가 전통적이나 **L2(투명형)** 도 가능. **DMZ**에 대외 서비스(메일·DNS·웹)를 분리 배치.
- **규칙 세트와 순서**: 규칙은 보통 `(S_IP, S_Port, D_IP, D_Port, proto, action)`이며 **선매칭 우선**. 잘못된 순서는 우회/누락을 초래할 수 있음.
- 그림
- **Stateless vs Stateful**:
    - _Stateless_: 매 패킷마다 규칙 조회 → **성능 손실**·세션 맥락 부재에 따른 **보안 구멍**(예: 백도어 포트 시도).
    - _Stateful_: **최초 패킷만 규칙**→세션 테이블 유지(타임아웃/keepalive 필요), 규칙 단순화·성능 개선.
- **Stateful Inspection**: 애플리케이션 문맥 인지(예: **FTP Active/Passive**를 해석해 **임시 규칙**을 동적으로 추가). 동적 포트/HTTP 터널링 등은 난점.
- **다계층 분리**: **다중 방화벽**으로 내부망·DMZ·DB망을 분리해 피해를 **DMZ에 국한**.

---

## 2) 고가용성(High Availability, HA)

- **방화벽 HA**
    - _L4/L7 스위치 기반_: 해시(H(src⊕dst) mod N)로 **세션 고정 분산**. 단, 장비 비용↑·장애 시 **기존 세션 소실**.
    - _커널 수준 세션 동기화_: 두 방화벽 간 **규칙/세션 테이블 동기화**로 무중단 전환.    
- **라우터 HA – VRRP/HSRP**: 가상 라우터에 대한 **선출 기반 장애조치**(마스터 광고 주기·우선순위). **ARP 트릭**을 활용하며, **MD5 HMAC 인증** 등 보안 기능 제공. 액티브/액티브는 **둘 이상의 가상 IP**로 구성.
- **서버 클러스터 HA**: 헬스체크/하트비트로 **가상 IP**를 동반 이관. **GSLB(Smart DNS)**로 응답 시간 기반 분산, DR 전환 시 **DNS TTL 최소화** 필요(브라우저 캐시 고려).
- **가용성 계산**: 단일 서버 가용성 `p`일 때, **n개 이중화** 가용성 `q_n = 1 - (1-p)^n`.
    - 예: `p=0.9999`이면 `n=2`에서 `q_2≈0.99999999`(연간 다운타임 극소).

---

## 3) 침입 탐지 시스템(IDS)

- **분류**: **HIDS**(무결성 체크/이상 자원 사용) vs **NIDS**(미러 포트/탭으로 패킷 관찰). **시그니처 기반**과 **이상 탐지** 병행.
- **용어**: TP/FP/FN/TN, 알람 필터링. **우회 기법**(다중 패킷 분산·조각화·TCP 덮어쓰기) 대응엔 **상태적 재조립** 필요.
- **도구/룰**: **Snort**(오픈소스 NIDS). 예시 룰 구성: `alert tcp any any -> any any (msg:"..."; flow:to_server; content:"admin"; sid:...; rev:...;)`.

---

## 4) DDoS

- **개념/사례**: 분산된 좀비/봇이 동원되는 서비스 거부. 고전 **Land 공격(자기 주소로 송수신)** 같은 DoS와 구분. 한국 **7.7 DDoS(2010)**: 수십만 봇·수십 Gbps 규모.
- **봇넷 패러다임**: 금전 이익 지향, **C&C(IRC/웹/P2P)**로 제어(스팸·HTTP flood 등).
- **탐지/완화의 어려움**: **정상 트래픽과 유사**, 개별 봇은 저대역, **플래시 크라우드**와 구분 어려움. 단순 확장(서버/대역폭 증설)엔 한계.
- **대응 전략**: 악성코드 감염 저감 캠페인, **조기 탐지·필터링**, **Anti-DDoS/IPS**, **봇마스터 추적**(여전히 어려움).

---

## 5) 침입 방지 시스템(IPS)

- **정의**: **IDS+방화벽**—인라인으로 공격을 **능동 차단**. DDoS 완화 기능 포함.
- **기법**:
    - **IP 스푸핑 판별**(예: **SYN-cookie** 활용),
    - **HTTP 레벨 테스트**(Cisco Guard 등),
    - **트래픽 베이스라인 학습**(예: 정상 클라이언트 <1 Mbps 등)으로 이상 탐지/레이트 조절.
- **현업 형태**: **UTM** 어플라이언스(방화벽/IPS/안티바이러스 통합)로 제공