# 6-1. SSL
## 1) SSL→TLS 배경과 구조

- **SSL의 계보**: 넷스케이프가 설계(SSLv3) → 인터넷 표준 **TLS**로 발전(SSL v3.1). HMAC 사용, PRF로 시크릿 확장, 경고코드/패딩 등의 차이가 추가됐어요.
- **TLS 레코드 계층**: TCP 위에서 동작하며 자체 **레코드** 단위를 사용(헤더+페이로드). 레코드 타입은 **애플리케이션 데이터/핸드셰이크/알럿/ChangeCipherSpec** 네 가지.
- **세션과 보안성**: 핸드셰이크로 만든 **세션**에 알고리즘/키 파라미터를 정의하고, 메시지 **무결성은 HMAC**, **기밀성은 대칭키 암호**(AES 등)에 기반합니다. 필요 시 압축 후 암호화합니다.
- **보조 프로토콜**: ChangeCipherSpec(보류 중이던 암호 스위트 적용), Alert(경고/치명 오류 코드 전송).

## 2) TLS 핸드셰이크(전통식 개요)

- **목표**: 상호 인증, 암호/해시 스위트 합의, **세션 키** 합의/검증. 단계는 (1) 능력 교환 → (2) 서버 인증/키교환 → (3) 클라이언트 인증/키교환 → (4) 종료.
- **흐름**: `client_hello → server_hello → client_key_exchange → finished`.
- **client_hello**: 최고 지원 **버전**, 랜덤, 세션ID, **사이퍼 스위트 목록(ECDHE_AES_SHA-256 등)**.
- **server_hello**: (필요 시) **서버 인증서**, 서버 랜덤, 선택된 사이퍼 스위트.
- **client_key_exchange**: **Pre-master secret S**를 합의/전달하고, 양측 랜덤과 함께 함수 f로 **Master secret K=f(S,R_A,R_B)**를 계산. 여기서 파생된 **세션 키 6개(방향별 암호키/무결성키/IV)**를 얻습니다.
- **finished**: 이전 핸드셰이크 전체에 대한 해시를 교환해 **키 합의가 일치하는지 검증**합니다.
- (선택) 서버가 인증서 요청을 보내 **클라이언트 인증**을 요구할 수도 있어요(예: 인터넷 뱅킹).
    

## 3) TLS 1.3 요점

- **최신 표준(2018)**, 1.2 대비 개선: **순방향 보안 강화(정적 RSA 배제)**, **핸드셰이크 지연 감소**(key share 확장으로 1-RTT).

## 4) 파이썬 TLS 실습(케이스 스터디)

- **키/인증서 생성**: `cryptography`로 RSA 개인키와 **localhost**용 자가서명 인증서 생성. (예시 코드 포함)
- **HTTPS 서버**: `ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)` 생성 → `load_cert_chain(server.cer, server.key)` → `HTTPServer` 소켓을 `wrap_socket`으로 감싸 **[https://localhost:443](https://localhost/)** 서비스.
- (슬라이드) 브라우저 개발자도구로 **협상된 스위트/랜덤/키교환값/암호화된 페이로드**를 확인하는 장면이 예시로 제공됩니다.

# 6-2. TLS
## 1) TLS 1.2 ↔ 1.3 핵심 차이

- **보안성**: 1.2에 있던 취약 구성(정적 RSA, CBC 등) 제거 → **PFS 기본 적용**, 안전한 조합만 허용(AES-GCM, ChaCha20-Poly1305 등).
- **성능/지연**: **1-RTT 핸드셰이크**(최대 50% 단축), 일부 상황 **0-RTT** 지원.
- **가시성 변화**: 1.3은 **서버 인증서도 암호화**되어 전송(평문 노출 축소).
- **레코드 보호**: HMAC 기반(MAC-then-Encrypt) → **AEAD 일체형**으로 단순화.
- **사이퍼 스위트**: (키교환/암호/해시 분리) → **인증 알고리즘 중심 간결화**.

## 2) ECH(Encrypted ClientHello)

- 문제: TLS 1.3에서도 **SNI, ALPN, 지원 암호 목록** 등이 ClientHello에서 평문으로 새어나감 → 트래픽 식별/검열 가능.
- 해결: **ECH**는 ClientHello의 민감 필드(Inner)를 **HPKE로 암호화**해 ClientHelloOuter에 숨김 → SNI·ALPN도 암호화되어 **도메인 노출 최소화**.
- 동작: 서버가 **ECHConfig**(HPKE 공개키 등)를 **DNS HTTPS RR**로 배포, 클라이언트는 이를 사용해 ClientHelloInner를 암호화. 예시 RR: `alpn="h2,h3"`, `echconfig="..."`, `ipv4hint=...`.
- 효과: **정부/ISP·방화벽의 SNI 기반 정책**이 어려워지고, 트래픽 식별 가능성이 크게 낮아짐.

## 3) DNS 보안: DNSSEC / DoT / DoH

- **DNSSEC**: 응답 무결성·진위 확인(서명) 제공, 단 **내용은 암호화되지 않음**.
- **DoT(853/TCP+TLS)**, **DoH(443/HTTPS)**: **질의·응답 자체를 TLS로 암호화**해 프라이버시 향상. 브라우저/대형 DNS 사업자들이 DoH/DoT 지원.
- **운영 관점**: DoH는 443을 사용해 **필터링 회피**가 쉬운 편, 배포/스케일에 유리. (자료는 비교 표와 사례 중심)

## 4) DoH를 악용한 은닉 채널

- **Godlua(2019)**, **OilRig(2020)** 사례처럼 **DoH를 C2 통신/도메인 획득에 악용**한 사례가 보고됨 → 보안 모니터링 시 애플리케이션 레벨 가시성/정책 필요.

## 5) 탐지용 데이터셋

- **CIRA-CIC DoHBrw-2020**: DoH 트래픽 기반 악성 행위 탐지 연구에 쓰이는 공개 데이터셋 소개.

## 6) JARM: TLS 서버 지문(Fingerprint)

- 개념: **서로 다른 10개의 ClientHello**(버전/암호/확장 순서 다양화)를 연속 전송 → **각 ServerHello 응답의 속성**을 수집·해시해 **62자 지문** 생성.
- 지문 구조: 앞 **30자**는 10회 협상에서 **버전/사이퍼 선택 결과**(거부 시 `000`), 뒤 **32자**는 **서버 확장들의 누적 요약(SHA-256 trunc.)**.
- 활용: **동일 인프라/운영 스택**으로 보이는 서버 군집화, **멀웨어 C2** 등 **악성 인프라 식별/블록리스트 고도화**에 활용.

# 6-3. Networking

- 로드맵: **Wireshark** 소개와 **패킷 전달**(Intra-LAN / Inter-LAN) 복습으로 구성.
- Wireshark 기본: 네트워크 **패킷 캡처·분석 도구**, 공식 사이트 제공. 캡처 창에는 인터페이스명/IP/패킷 수/초당 패킷, Start/Stop/Options 등이 표시되며 **Display filter**로 원하는 트래픽만 조회 가능.
- 예제 토폴로지: **세 개의 LAN**이 라우터로 상호 연결(예: 192.168.161.x / 192.168.162.x, 게이트웨이 192.168.161.1/192.168.162.1, 백본 10.0.0.x).
- Intra-LAN 전달: 에코 클라이언트/서버 예제로 **라우팅 테이블(netstat -rn)** 확인 후, **Longest Prefix Matching**으로 다음 홉 결정 → 같은 서브넷이면 **ARP 요청/응답**으로 상대 MAC을 알아낸 뒤 전송.
- Inter-LAN(WAN) 전달:
    1. 발신 호스트는 라우팅 테이블을 보고 **게이트웨이(예: 192.168.161.1)** 로 보낼 규칙 선택, 이후 전달 책임은 라우터에 귀속.
    2. 게이트웨이 MAC을 모르면 **ARP 브로드캐스트(FF:FF:FF:FF:FF:FF)** 로 질의 → 라우터가 **ARP Reply**로 자신의 MAC을 회신 → 발신 호스트는 ARP 테이블에 매핑 후 라우터로 전송.
    3. 이후 **각 라우터가 자체 라우팅 테이블**로 다음 홉을 결정해 목적지 LAN/호스트까지 전달.
- 이름 해석: **DNS vs hosts 파일**(Windows 경로 `C:\Windows\System32\drivers\etc`) 비교 소개.
- 참고문헌/사이트: **Kurose & Ross** 교재, **wireshark.org**.
