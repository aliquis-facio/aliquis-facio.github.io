# Broken Access Control
## 1. 배경 (Background)

- 2021에 이어 **2025 RC1에서도 1위**를 유지하는 취약점.
- 분석된 **모든 애플리케이션(100%)** 에서 어떤 형태로든 접근제어 취약점이 발견됨.
- 대표적으로 연결된 CWE:
    - **CWE-200/201**: 인가되지 않은 사용자에게 민감정보 노출
    - **CWE-918**: SSRF
    - **CWE-352**: CSRF 등
- 수집된 데이터 중 **발생 건수 최다**, 관련 **CVE 수도 상위권**에 해당.

## 2. 점수표 (Score table)

| CWEs Mapped | Max Incidence Rate | Avg Incidence Rate | Max Coverage | Avg Coverage | Avg Weighted Exploit | Avg Weighted Impact | Total Occurrences | Total CVEs |
| ----------- | ------------------ | ------------------ | ------------ | ------------ | -------------------- | ------------------- | ----------------- | ---------- |
| 40          | 20.15%             | 3.74%              | 100.00%      | 42.93%       | 7.04                 | 3.84                | 1,839,701         | 32,654     |

- 매핑된 CWE 개수: **40개**
- 최대 발생률: **20.15%**
- 평균 발생률: **3.74%**
- 최대 커버리지: **100%**, 평균 커버리지: **42.93%**
- 평균 가중 익스플로잇 점수: **7.04**
- 평균 가중 영향 점수: **3.84**
- 총 발생 횟수: **1,839,701**
- 관련 CVE 수: **32,654**
→ 현실 서비스에서 **가장 자주, 광범위하게 등장**하는 카테고리라는 의미.

## 3. 설명 (Description)
### 3.1 접근 제어란?

- **접근 제어(access control)** 는 사용자가 **부여된 권한 범위 밖의 행동을 못 하도록** 정책을 강제하는 것.
- 실패하면:
    - 인가되지 않은 정보 열람 / 수정 / 삭제
    - 인가되지 않은 기능(예: 일반 사용자가 관리자 기능 실행) 수행으로 이어짐.

### 3.2 흔한 취약 패턴

OWASP가 나열하는 전형적인 실패 사례들:

1. **최소 권한 원칙 위반 (deny by default 불이행)**
    - 기본은 허용, 일부만 막는 식으로 설계 → 누구나 접근 가능한 리소스가 생김.
2. **URL/파라미터/상태 변경으로 우회**
    - URL, 쿼리 파라미터, 폼 필드, 클라이언트 상태 등을 바꾸어 권한을 우회(파라미터 변조, force browsing).
3. **IDOR (Insecure Direct Object Reference)**
    - `/user/1234` 대신 `5678`로 바꾸면 다른 사람 정보에 접근 가능.
4. **API에 인가 체크 없음**
    - `POST/PUT/DELETE` 같은 변경 API에 접근제어가 빠져 있음.
5. **권한 상승 (Privilege escalation)**
    - 로그인 안 했는데도 유저처럼 행동 가능,
    - 일반 유저인데 관리자 역할을 수행 가능 등.
6. **메타데이터 조작**
    - JWT, 쿠키, hidden field 등을 변조해 권한 상승 혹은 만료된 토큰 재사용.
7. **CORS 설정 오류**
    - 신뢰할 수 없는 오리진에서도 API 호출이 가능하게 열어둔 경우.
8. **Force browsing**
    - 인증 안 한 상태로 인증이 필요한 URL 접근, 일반 유저가 관리자 페이지 URL을 추측해서 접근 등.

## 4. 예방 방법 (How to prevent)

핵심 메시지: **신뢰할 수 있는 서버 측(or serverless 백엔드)에서 일관된 방식으로 접근제어를 구현하라.**

주요 권고사항:
1. **기본은 차단 (Deny by default)**
    - 공개 리소스가 아닌 이상, 허용 목록 기반으로만 접근 허용.
2. **접근제어 로직의 중앙화 & 재사용**
    - 여기저기 조건문으로 흩어놓지 말고 **공통 모듈/미들웨어/필터**로 구현해서 서비스 전반에서 재사용.
    - CORS도 최소한으로 사용.
3. **레코드 소유권 기반 접근제어**
    - 단순히 “ROLE_USER이면 user 데이터 CRUD 가능”이 아니라,  
        “이 레코드의 owner가 현재 사용자와 일치하는지”를 모델/쿼리 단계에서 강제.
4. **비즈니스 제한(도메인 규칙) 강제**
    - 예: 1일 송금 한도, 포인트 사용 한도 등 비즈니스 정책을 서버 측 모델에서 강제.
5. **디렉터리 리스팅 및 민감 파일 제거**
    - 웹 루트에 `.git`, 백업 파일, 설정 파일 등이 노출되지 않도록.
    - 웹 서버 디렉터리 listing 비활성화.
6. **접근제어 실패 로그 & 알림**
    - 반복된 실패, 이상한 패턴에 대해 알림/모니터링.
7. **API/컨트롤러에 레이트 리밋**
    - 브루트포싱 / 자동 공격의 피해 최소화.
8. **세션/토큰 관리**
    - stateful 세션 ID: 로그아웃 시 서버에서 무효화.
    - JWT 같은 stateless 토큰:
        - **가능한 짧은 만료 시간** 사용.
        - 장기 토큰은 OAuth 표준에 따라 **revocation(철회)** 메커니즘 도입.
9. **검증된 도구/패턴 사용**
    - 프레임워크에서 제공하는 annotation, policy, RBAC/ABAC 모듈을 적극 활용.
    - 개발/QA 단계에서 **기능 테스트에 접근제어 케이스를 반드시 포함**.

## 5. 예시 공격 시나리오 (Example attack scenarios)

OWASP가 제시하는 대표 예시들:

### 시나리오 1: 계좌번호 파라미터 변조(IDOR)

```java
pstmt.setString(1, request.getParameter("acct"));
ResultSet results = pstmt.executeQuery();
```

- URL: `https://example.com/app/accountInfo?acct=notmyacct`
- 계좌 번호 파라미터를 임의로 바꾸면, 다른 사람 계좌 정보까지 조회 가능.
- 서버에서 **현재 로그인한 사용자와 acct의 소유자가 일치하는지 검사하지 않아서 발생**.

### 시나리오 2: 관리자 페이지 직접 접근

- URL 예:
    - `https://example.com/app/getappInfo` (일반 페이지)
    - `https://example.com/app/admin_getappInfo` (관리자 페이지)
- 인증/인가 체크가 제대로 없다면:
    - 인증 안 된 사용자가 접근 가능,
    - 일반 유저가 관리자 페이지에 접근 가능 → 모두 취약점.
	
### 시나리오 3: 프론트엔드에만 존재하는 접근제어

- 프론트 JS에서만 “관리자 메뉴 숨기기” 등을 해둔 경우.
- 공격자는 단순히:

```bash
curl https://example.com/app/admin_getappInfo
```

- 처럼 HTTP 요청만 직접 보내서 우회 가능.
- **접근제어는 절대 클라이언트(브라우저)에서만 구현하면 안 됨**을 보여주는 전형적인 예.