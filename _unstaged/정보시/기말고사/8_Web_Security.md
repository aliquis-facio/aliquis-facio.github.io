# 8-1. Web Security

## 1) WEB/HTTP 개요

- **클라이언트–서버, 무상태(Stateless)** 모델. 요청/응답 메시지 구조(요청라인·헤더·바디 / 상태라인·헤더·바디), URL 구성요소(스킴·호스트·포트·경로·쿼리·프래그먼트).

## 2) Web Shell

- **CWE-434(임의 파일 업로드 허용)**로 웹서버가 실행파일을 업로드·실행하게 되면 **원격 명령 실행**이 가능.
- **대응**: 업로드 제한(확장자/크기·MIME 검사), 실행권한 제거, 웹앱에 루트 권한 금지.

## 3) Cookie

- **역할**: 무상태 HTTP에 **상태** 부여(인증·장바구니·세션 식별 등). `Set-Cookie` 속성: `domain`, `path`, `secure`, `expires`, (현대 브라우저의 `HttpOnly`).
- **문제**: 서버는 실제로 **name=value**만 보며, 클라이언트가 **임의 조작** 가능(쿠키 포이즈닝). SSL 미적용 구간에서는 **탈취 위험**. **도메인/경로 스코프 충돌**로 세션 오염 가능(서브도메인 간).
- **대응**: 전 구간 **TLS**, **무결성 태그(서버비밀키 기반 MAC)**로 값 위조 방지.

## 4) 세션 관리(Session Management)

- **세션 토큰 전달 위치**: 쿠키, URL 파라미터, 숨김필드.
- **위험**:
    - **Referer 유출**(URL에 토큰 포함 시 제3자에 노출),
    - **토큰 예측 가능성**,
    - **세션 하이재킹(토큰 탈취)**,
    - **세션 고정(Session Fixation)**—공격자가 미리 정한 토큰으로 로그인 유도.
- **대응**:
    - **로그인 시 토큰 재발급(익명→로그인 전환 시 반드시 새 토큰)**,
    - **강한 토큰 설계**(예: `SID=[userID,exp,data]`, `Token=HMAC_k(SID)`),
    - 클라이언트 특성(IP/UA) 일부 포함(완벽하진 않지만 난이도 상승),
    - 매 요청마다 **로그아웃 상태/만료 검사**.

## 5) XSS(Cross-Site Scripting)

- **정의**: 사용자 입력을 적절히 **중화(escape/필터)**하지 않고 페이지에 반영할 때 **스크립트 주입** 발생.
- **유형**:
    - **Persistent(저장형)**: 게시판/메일 등 저장된 악성 스크립트가 다른 사용자에게 전파.
    - **Reflected(반사형)**: 쿼리스트링 등 요청에 섞인 스크립트가 즉시 응답에 반사.
- **영향**: 세션 쿠키 탈취, DOM 조작, 피싱·키로깅 등.
- **대응**:
    - **입력 검증**과 **출력 인코딩**(컨텍스트별—HTML/속성/JS/URL),
    - 스크립트 비활성화(콘텐츠 보안 정책 CSP 등 개념적으로 연결),
    - 예시: `< > " '` 등을 HTML 엔티티로 치환.

# 8-2. Web Security

## 1) CSRF (Cross-Site Request Forgery)

- **개념**: 사이트가 사용자의 브라우저를 신뢰한다는 점을 악용해, 로그인 상태의 사용자가 **의도하지 않은 요청**을 보내게 만드는 공격. XSS가 “사용자가 사이트를 신뢰”하는 점을 노린다면, **CSRF는 “사이트가 브라우저를 신뢰”**하는 점을 노립니다.
- **사례**:
    - 이미지 태그로 **송금 URL**을 로드해 자동 요청 유발(쿠키 동반).
    - 관리자 비밀번호 **강제 초기화** 요청을 XSS와 결합해 실행.
- **성공 전제**: Referer 미점검, 부작용 있는 URL/폼 존재, 필요한 파라미터를 공격자가 추측 가능, 사용자가 로그인된 상태로 악성 페이지 방문.
- **대응**: 세션 관리 강화, **GET/POST에 추가 인증 요소** 요구, **Referer 점검**, 인증 쿠키 **수명 제한**, **POST 처리 시 GET 파라미터 무시**, **사용자별 CSRF 토큰** 검증.

---

## 2) SQL Injection

- **개념**: 입력을 적절히 **이스케이프/검증**하지 않거나 강타입 검증이 없어 **SQL 문맥이 깨져** 의도치 않은 쿼리가 실행됨.
- **고전 예시**: `' or '1=1'--` 로 WHERE 절을 항상 참으로 만들어 인증을 우회. (MSSQL에서 `--`는 주석)
- **더 심각한 피해**: `'; DROP TABLE members --` 로 **테이블 삭제** 등 데이터 파괴.
- **대응**: 입력 **불신·화이트리스트 검증**, **특수문자 필터/이스케이프**, **에러 메시지 노출 금지**, **DB 계정 최소 권한**.

---

## 3) IDOR (Insecure Direct Object Reference)

- **개념/예시**: 예측 가능한 리소스 식별자를 노출하면 사용자가 번호만 바꿔 **권한 밖 리소스**에 접근 가능(예: `one-piece-554-english.html` → `…555…`).
- **대응**: **난수화/간접 참조** 적용 + **매 접근 시 권한 확인(Authorization)**.

---

## 4) 관리자 영역 접근 통제

- **원칙**: 관리자 페이지는 **접근 자체를 제한**하고, 추측 쉬운 경로명 사용 금지(`/admin`, `/manager`, 하위 도메인 등).
- **대응**: **별도 포트 + 방화벽 ACL**, **웹서버 레벨 디렉터리 접근 제어(Allow/Deny, IP 화이트리스트)**. 설정 예시:
    ```
    <Directory /www/admin/>
      AllowOverride AuthConfig
      Order deny, allow
      Deny from all
      Allow from IP lists
    </Directory>
    ```
    

---

## 5) 취약점 스캐너

- **정의/주의**: 알려진 취약점을 자동 탐지(nmap, nessus 등). 일부는 **실제 공격을 수행**하므로 서비스 영향에 유의.
- **종류**: **블랙박스**(Nikto, Burp Scanner, Acunetix 등) / **화이트박스**(Fortify SCA, HP DevInspect, PMD 등).