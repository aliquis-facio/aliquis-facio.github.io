## 히스토그램(영상처리) 핵심 정리

### 1) 정의와 표기

- **정의:** 밝기(또는 색상) 값의 **분포**를 세는 함수.  
    (h(k)=#{(i,j)\mid f(i,j)=k}), (k\in[0,L-1]) (일반적으로 (L=256)).
    
- **정규화 히스토그램:** (p(k)=\dfrac{h(k)}{MN}) (확률해석 가능).
    
- **누적분포(CDF):** ().
    

### 2) 무엇에 쓰나

- **노출/대비 진단:** 어두움 편향(좌측 치우침), 과다노출(우측 포화), 저대비(중앙 좁은 분포) 판단.
    
- **이진화/임계값 선정:** 봉우리(클래스) 구조 파악, **Otsu**의 전역 임계값에 입력.
    
- **색/질감 단서:** 채널별/공동(2D, 3D) 히스토그램의 **정합·검색**(ex. 색 기반 retrieval).
    
- **검출(역투영 Backprojection):** 모델 히스토그램을 확률 맵으로 사상해 후보 영역 추출.
    

### 3) 주요 변환

- **히스토그램 평활화(HE):**  
    목표: 대비 ↑. 매핑: (s=\lfloor (L-1),c(r)\rfloor).  
    장점: 전역 대비 개선. 단점: **노이즈 증폭/밴딩**, 국부 콘트라스트 과장.
    
- **CLAHE(적응형 평활화):**  
    타일별 HE + **clip limit**로 과증폭 제어 → 의료/얼굴 등에서 안정적.
    
- **히스토그램 매칭/사양(Specification):**  
    원본 CDF (c)를 목표 CDF (c^*)에 맞추는 **역함수 매핑** (s=c^{-1}(c^*(r))).
    

### 4) 컬러 히스토그램

- **단일 채널 조합:** RGB 채널 **독립** 처리(간단, 빠름).
    
- **공동 히스토그램:** 2D(예: H–S) 또는 3D(R–G–B) **공동 분포**(정합 정확도↑, 연산·메모리↑).
    
- **정규화/정량화:** 조명 영향 완화 위해 **정규화**(L1, L2)와 **bin 수 축소**(예: 32–64 bins) 사용.
    

### 5) Backprojection(요약 절차)

1. ROI(대상) 히스토그램 계산 → 정규화.
    
2. 입력 영상의 각 픽셀 값을 해당 bin 확률로 **치환** → 확률 맵.
    
3. 평활화·임계값·모폴로지로 후처리 → 후보 영역/피크 검출.
    

### 6) 구현/실무 팁

- **사전 평활화:** 임계값/HE 전에 가우시안·중값으로 **노이즈 완화**.
    
- **다운샘플링 전 저역통과:** 히스토그램도 고주파 alias 영향 받음.
    
- **얼굴/피부처럼 미세톤 중요:** 전역 HE 대신 **CLAHE** 권장.
    
- **HDR/RAW 파이프라인:** 10/12-bit에서 톤매핑 후 8-bit 표출 시, HE의 **밴딩** 가능성 점검.
    
- **OpenCV 빠른 레시피:**
    
    - `cv.calcHist`, `cv.normalize`
        
    - `cv.equalizeHist`, `cv.createCLAHE(clipLimit, tileGridSize)`
        
    - `cv.calcBackProject`
        

### 7) 자주 나오는 질문 정리

- **HE vs CLAHE?** 전역 콘트라스트만 올리면 HE, 국부 구조 보존/노이즈 억제는 CLAHE.
    
- **bin 수 선택?** 데이터 크기·잡음 수준에 따라 32–256. **너무 세밀**하면 잡음 민감, **너무 거칠면** 정보 손실.
    
- **컬러 HE?** 채널 독립 HE는 색 왜곡 가능. 보통 **Y(밝기) 채널만** 처리(예: YCrCb/HSV).
    

> 한 줄 요약: 히스토그램은 **밝기/색 분포의 통계 요약**으로, **진단(노출/대비)**, **변환(HE/CLAHE/매칭)**, **검출(Backprojection)**, **분할/임계값(Otsu)**의 **출발점**이다.