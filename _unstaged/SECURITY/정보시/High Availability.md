## 3. 고가용성(High Availability, HA)
### 3-1. 기본 아이디어
- 질문: “**방화벽이 죽으면 서비스는?**”
- 엔터프라이즈 네트워크는 **예상치 못한 장애**를 대비해야 함.
- 한 장비/라우터/방화벽이 죽어도 서비스가 멈추지 않도록 **중복(redundancy)** 를 가지는 구조 → **HA, 무정지 서비스**.

### 3-2. Firewall HA – L4/L7 스위치 기반

- 여러 대의 방화벽 앞에 **L4/L7 스위치**를 두고,
    - 해시 `H(src_ip XOR dst_ip) mod N` 같은 방식으로 세션을 여러 방화벽에 **균등 분산**.
- 단점:
    - L4/L7 스위치 장비가 비싸고 복잡.
    - 중간에 방화벽 하나가 죽으면 **그 방화벽으로 가던 세션은 모두 끊김**.

### 3-3. Router HA – VRRP

- **VRRP (Virtual Router Redundancy Protocol)**
    - 여러 대의 라우터가 **하나의 “가상 게이트웨이 IP(virtual IP)”** 를 공유.
    - 내부 호스트들은 **디폴트 게이트웨이로 이 virtual IP만** 설정.
- **Active–Standby (Master–Backup)** 구조:
    - Master 라우터가 virtual IP를 들고 실제 라우팅.
    - Backup 라우터는 대기하며, Master의 **주기적인 광고(hello/advertisement)** 를 듣는다.
    - 광고가 더 이상 안 오면 → Master 장애로 판단 → Backup이 virtual IP를 인계.
    - 내부 호스트는 여전히 같은 gw IP로 쓰기 때문에 **서비스 중단 없이 계속 통신**.
- **Active–Active 구조**:
    - virtual IP를 2개 이상 두고, 라우터 A/B가 각각 하나씩 담당.
    - 부하 분산 + 장애 시 나머지가 가져가는 방식.

#### VRRP의 보안 이슈 & 인증

- VRRP는 **본질적으로 “가용성” 프로토콜**이지만,
    - “누가 Master인지 알려주는 광고”가 **위조 가능**하면 공격 표면이 됨.
- 공격 시나리오:
    - 공격자가 VRRP 광고를 위조해서 “내가 Master다”라고 속이면,
    - 내부 호스트들이 공격자 PC를 게이트웨이로 사용 → 트래픽 가로채기 가능.
- 해결:
    - VRRP 광고에 **인증(예: 공유 비밀키 기반, 해시)** 을 붙여 “메시지가 위조되지 않았음”을 검증.

### 3-4. 데이터센터 이중화 & DR 센터

- 9/11 테러 이후, “**전산센터 자체가 날아가면?**” 이슈 → **DR 센터 (Disaster Recovery Center)** 개념 등장.
- 구조:
    - 메인 센터(예: 서울) + DR 센터(예: 부산)를 지리적으로 떨어뜨려 구성.
    - DB, 스토리지, 핵심 서비스 등을 실시간/주기적으로 동기화.
- DNS 기반 GSLB 같은 기술:
    - 하나의 서비스 도메인을 여러 위치의 IP에 매핑.
    - DNS TTL과 헬스 체크를 조정해 장애 시 다른 센터로 트래픽을 돌려줌.
- 목표:
    - **Single Point of Failure(SPOF)** 제거,
    - 센터가 통째로 날아가도 서비스가 계속되도록 설계.